# 核心求解器修正報告：數值不穩定與邊界反射修復

**日期:** 2026-02-21  
**修改模組:** `src/lbm_mrt_les/core/LBM2D_MRT_LES.py`  
**議題:** 模擬過程中速度場能量累積導致數值爆炸 (Velocity Explosion)

---

## 1. 問題描述

在執行高雷諾數 (Re=4000, $
u=0.0025$) 模擬時，觀察到流場速度在長時間運算後發生異常累加，最終導致數值發散（爆炸）。此現象通常伴隨強烈的壓力波在計算域內來回震盪，特別是在入口 (Inlet) 與障礙物之間。

## 2. 原因分析

經過代碼審查與配置比對，確認主要原因為 **阻尼層 (Sponge Layer) 實作不完整** 與 **配置參數未生效**：

1.  **配置脫鉤 (Configuration Decoupling):**
    *   原始代碼中的阻尼層參數（寬度、強度）為 **Hardcoded (寫死)**，完全忽略了 `config.yaml` 中 `domain_zones` 的設定。這導致使用者在 Config 中調整的參數無效。
    
2.  **入口阻尼缺失 (Missing Inlet Sponge):**
    *   LBM 在高雷諾數下，障礙物產生的壓力波會逆流而上傳遞至入口。
    *   原代碼 **僅實作了出口 (Outlet) 與上下邊界** 的阻尼。
    *   **關鍵缺失：** 缺少 **入口 (Inlet)** 的阻尼層。當逆流波抵達強制速度入口 (Dirichlet Boundary) 時，會發生全反射，並與後續生成的波疊加共振，導致全場能量無法耗散而爆炸。

3.  **穩定性臨界 (Stability Limit):**
    *   設定 $
u=0.0025$ 對應鬆弛時間 $	au \approx 0.5075$。此數值極接近 LBM 的理論穩定下限 0.5。在此極限狀態下，任何未被吸收的邊界反射波都會被放大。

---

## 3. 修正內容

已針對 `LBM2D_MRT_LES.py` 進行以下核心修正：

### A. 參數讀取優化 (`__init__`)
將阻尼層參數改為從 `config['domain_zones']` 動態讀取，確保實驗配置生效。

```python
# 修改前 (Hardcoded)
# sponge_width_x = 200
# ...

# 修改後 (Dynamic)
zones = self.config.get("domain_zones", {})
self.sponge_w_x = zones.get("sponge_x", 128)      # Outlet
self.sponge_w_in = zones.get("inlet_buffer", 64)  # Inlet (New)
self.sponge_w_y = zones.get("sponge_y", 40)       # Top/Bottom
self.sponge_strength = 2.0
```

### B. 全方位阻尼層實作 (`collide_and_stream`)
在碰撞核心 (Kernel) 中重寫了阻尼邏輯，新增了入口阻尼區。

1.  **Inlet Sponge (New):** 在 $x < sponge\_w\_in$ 區域施加阻尼，吸收逆流壓力波。
2.  **Outlet Sponge:** 在 $x > nx - sponge\_w\_x$ 區域施加阻尼。
3.  **Top/Bottom Sponge:** 在 $y < sponge\_w\_y$ 與 $y > ny - sponge\_w\_y$ 區域施加阻尼。
4.  **Max Blending:** 使用 `tm.max()` 疊加不同方向的阻尼係數，避免角落處過度黏滯。

---

## 4. 建議後續行動

1.  **驗證模擬:** 請重新執行發生爆炸的案例 (Case L200_0000)。預期入口阻尼層將有效抑制壓力波反射，解決爆炸問題。
2.  **參數微調:** 若在 $	au \approx 0.5075$ 下仍偶發不穩定，建議：
    *   稍微增加 `nu` (例如至 0.003)。
    *   或在 Config 中增加 `sponge_strength` (例如至 2.5 或 3.0)。
