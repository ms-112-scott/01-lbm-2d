# 04_數據管線開發進度

本文件記錄 `lbm_2d` 專案中數據生成、處理與輸出管線的開發狀態。

## 1. 核心管線 (Core Pipeline)

- [x] **Solver 核心**: MRT-LBM + LES 湍流模型。
- [x] **多通道輸出**: 支援 9 個 MRT Moments 通道輸出 (rho, e, eps, jx, qx, jy, qy, pxx, pxy)。
- [x] **HDF5 Writer**: 高效能異步數據寫入器 (`AsyncLBMCaseWriter`)。
- [x] **靜態遮罩 (Static Mask)**: 寫入幾何遮罩 (0/1) 與 SDF (Signed Distance Field)。
- [x] **累積統計 (Accumulated Stats)**: 計算並輸出累積渦度 (`sum_vor`) 與時序平均場 (`mean_field`)。

## 2. 批量生成 (Batch Generation)

- [x] **幾何生成**: `mask_rect_gen.py` (隨機矩形) 與 `hybrid_map_gen.py` (複雜混合場景)。
- [x] **參數控制**: 支援透過 Config 檔案完全控制物理參數 (Re, nu, Resolution)。
- [x] **Config-Mask 一對一**: `run_multi_case.py` 支援每張 Mask 對應獨立的物理設定 (Re sweep)。
- [x] **特徵長度 (L_char)**: 自動計算並嵌入檔名，供 Solver 動態調整黏滯係數。

## 3. 數據格式 (Data Format)

- [x] **HDF5**: 確定為主要輸出格式 (Self-contained, Fast I/O)。
- [ ] **Zarr**: (評估中) 適用於更大規模的雲端訓練或平行讀取，目前 HDF5 已足夠。
- [ ] **TFRecord / WebDataset**: (待辦) 若需與 TensorFlow / PyTorch DataLoader 高度整合可考慮轉檔。

## 4. 驗證與測試 (Validation)

- [x] **物理守恆**: 質量與動量守恆性檢查 (基本通過)。
- [x] **DFG Benchmark**: 阻力/升力係數計算邏輯已實作 (`compute_force_on_obstacle`)，待大規模驗證。
- [ ] **長期穩定性**: 需進行更長時間步數 (100k+) 的測試。

---

## 5. 下一步計畫 (Next Steps)

1.  **PyTorch DataLoader 實作**: 開發專用的 Dataset Class 讀取 HDF5。
2.  **數據增強模組**: 實作物理一致的幾何變換 (翻轉/旋轉)。
3.  **大規模數據生成**: 使用 `hybrid_map_gen` 生成 1000+ 張不同 L_char 與 Re 的訓練數據。