# LBM-MRT 理論基礎

本文件詳細介紹 Lattice Boltzmann Method (LBM) 以及本專案採用的 Multiple Relaxation Time (MRT) 碰撞模型。

## 1. LBM 基礎概念

LBM 是一種基於介觀尺度 (Mesoscopic) 的計算流體力學方法。不同於傳統 CFD 直接求解 Navier-Stokes 方程 (宏觀尺度)，LBM 模擬流體粒子分佈函數 $f(\mathbf{x}, \mathbf{e}, t)$ 的演化。

### 1.1 D2Q9 模型
本專案使用二維九速模型 (D2Q9)，包含 9 個離散速度方向 $\mathbf{e}_i$：
- 中心 (0): $(0, 0)$
- 軸向 (1-4): $(\pm 1, 0), (0, \pm 1)$
- 對角 (5-8): $(\pm 1, \pm 1)$

### 1.2 LBM 演化方程
$$ f_i(\mathbf{x} + \mathbf{e}_i \Delta t, t + \Delta t) - f_i(\mathbf{x}, t) = \Omega_i(f) $$
其中 $\Omega_i$ 為碰撞算子。

---

## 2. MRT (Multiple Relaxation Time) 碰撞模型

傳統的 LBM 使用單一鬆弛時間 (SRT/BGK) 模型，即所有物理量以相同的速率 $\tau$ 衰退。這在高雷諾數下容易導致數值不穩定。

MRT 模型透過線性轉換，將粒子分佈 $f$ 轉換到 **矩空間 (Moment Space)** $\mathbf{m}$，讓不同的物理量 (密度、動量、應力、高階矩) 可以獨立衰退。

### 2.1 轉換過程 (基底變換)

我們可以把這想像成圖片處理中的顏色轉換：
- **$f$ (粒子空間)** 就像是 RGB 格式。
- **$m$ (矩空間)** 就像是 HSL 格式 (色相、飽和度、亮度)。
- **操作 $M$** 就是把 RGB 轉成 HSL，讓我們能單獨調整亮度而不影響色相。

數學上：
$$ \mathbf{m} = \mathbf{M} \mathbf{f} $$
$$ \mathbf{m}^* = \mathbf{m} - \mathbf{S} (\mathbf{m} - \mathbf{m}^{eq}) $$
$$ \mathbf{f}^{new} = \mathbf{M}^{-1} \mathbf{m}^* $$

其中 $\mathbf{M}$ 為轉換矩陣，$\mathbf{S}$ 為對角鬆弛矩陣。

### 2.2 D2Q9 轉換矩陣 $\mathbf{M}$

本專案採用 Lallemand & Luo (2000) 定義的矩陣。每一行代表一種物理特徵：

| Index | 符號 | 物理意義 | 矩陣列向量 (Row Vector) |
| :--- | :--- | :--- | :--- |
| 0 | $\rho$ | **密度** | `[ 1, 1, 1, 1, 1, 1, 1, 1, 1]` |
| 1 | $e$ | **能量** | `[-4, -1, -1, -1, -1, 2, 2, 2, 2]` |
| 2 | $\epsilon$ | **能量平方** | `[ 4, -2, -2, -2, -2, 1, 1, 1, 1]` |
| 3 | $j_x$ | **動量 X** | `[ 0, 1, 0, -1, 0, 1, -1, -1, 1]` |
| 4 | $q_x$ | **熱通流 X** | `[ 0, -2, 0, 2, 0, 1, -1, -1, 1]` |
| 5 | $j_y$ | **動量 Y** | `[ 0, 0, 1, 0, -1, 1, 1, -1, -1]` |
| 6 | $q_y$ | **熱通流 Y** | `[ 0, 0, -2, 0, 2, 1, 1, -1, -1]` |
| 7 | $p_{xx}$ | **正應力** | `[ 0, 1, -1, 1, -1, 0, 0, 0, 0]` |
| 8 | $p_{xy}$ | **切應力** | `[ 0, 0, 0, 0, 0, 1, -1, 1, -1]` |

### 2.3 物理意義解讀

- **守恆量 ($\rho, j_x, j_y$)**: 對應 Index 0, 3, 5。這些量在碰撞過程中保持不變 (鬆弛率 $s=0$ 或不影響)。
- **物理應力 ($p_{xx}, p_{xy}$)**: 對應 Index 7, 8。這些量代表黏滯性與剪切力。其鬆弛率 $s_{\nu}$ 直接決定了流體的運動黏滯係數 $\nu$。
- **非物理/鬼影模態 ($e, \epsilon, q_x, q_y$)**: 對應 Index 1, 2, 4, 6。這些是高階矩，對於不可壓縮流體來說是「數值噪音」。

---

## 3. MRT 的優勢：分離物理與噪音

在 BGK 模型中，所有模態共用一個 $\tau$。若要模擬低黏度流體 (高 Re)，$\tau$ 必須非常接近 0.5，導致鬆弛參數 $\omega = 1/\tau \approx 2.0$。這意味著**噪音也會被劇烈放大**，導致模擬發散。

在 MRT 模型中：
1.  **物理項 (應力)**: 設為 $s_{\nu}$ (接近 2.0)，保留真實的湍流特徵。
2.  **噪音項 (鬼影)**: 設為 $s_{ghost} \approx 1.1$ (遠離 2.0)。

這樣做可以**「快速殺死短時間的壓縮聲波與數值噪音」**，同時保留流體的低黏度特性，從而顯著提升數值穩定性。