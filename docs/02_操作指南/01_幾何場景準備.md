# 01_幾何場景準備 (Mask Generation)

在開始模擬前，必須先準備好定義流場邊界的幾何遮罩 (Mask)。所有遮罩的生成與管理，現在都透過中央設定檔 `master_config.yaml` 進行控制。

## 1. 核心概念：專案化管理

新的工作流程以 **專案 (Project)** 為核心。所有與特定實驗相關的輸入檔案 (Masks, Configs) 都會被存放在 `SimCases/{project_name}/` 資料夾中。

- **`project_name`**: 在 `master_config.yaml` 的 `settings` 區塊中定義，例如 `"Hyper"`。

---

## 2. 遮罩格式說明

- **格式**: PNG 圖片 (灰階)
- **數值定義**:
  - **黑色 (0)**: 固體障礙物 (Obstacle)
  - **白色 (255)**: 流體區域 (Fluid)
- **座標系**: 圖片左上角為 (0,0)，對應 LBM 模擬的左上角。

> **注意**: `master_config.yaml` 中的 `map_generator.output.invert_values` 參數可用於反轉此定義 (預設為 `true`)。

---

## 3. 混合地圖生成器 (`hybrid_map_gen.py`)

這是目前主要的遮罩生成工具，適用於生成複雜的混合場景，包含多種流動特徵。

### 功能特點
- **中央化配置**: 所有生成參數都在 `master_config.yaml` 的 `map_generator` 區塊中設定。
- **物理參數嵌入**: 生成的檔名會自動包含 **目標物理雷諾數 (Re)** 與 **特徵長度 (L_char)**，例如 `Re1000_L120_0000.png`。
- **自動化輸出**: 腳本會讀取 `project_name` 並將所有遮罩自動儲存至 `SimCases/{project_name}/masks/`。

### 使用方法

1.  **設定 `master_config.yaml`**:
    -   確認 `settings.project_name`。
    -   調整 `map_generator` 內的參數以符合需求。
    -   確認 `physics_control.re_list` 包含您想生成的雷諾數。

2.  **執行生成腳本**:
    ```bash
    python src/tools/hybrid_map_gen.py
    ```

### 輸出結構

```text
SimCases/
└── Hyper/                # project_name
    └── masks/            # 自動生成的遮罩存放於此
        ├── Re1000_L120_0000.png
        ├── Re2000_L100_0001.png
        └── ...
```

---

## 4. 自定義遮罩

若您需要使用自製的遮罩：
1.  依照 **遮罩格式說明** 製作您的 `.png` 檔案。
2.  為其命名，需符合格式 `Re{Re}_L{L_char}_{id}.png` (例如: `Re500_L80_custom.png`) 以便後續腳本能正確解析物理參數。
3.  將檔案放入對應專案的資料夾：`SimCases/{project_name}/masks/`。
