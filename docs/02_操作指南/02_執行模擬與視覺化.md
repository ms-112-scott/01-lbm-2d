# 02_執行模擬與視覺化

本篇指南說明如何使用 Taichi LBM-2D 執行模擬，包括單一案例測試與批量生成模式。

## 1. 執行單一案例 (run_one_case)

適用於快速測試特定設定檔或除錯。此模式會讀取 `config.yaml` 並依序執行指定目錄下的所有 Mask。

### 基本指令

```bash
# 使用預設 Config 與 Mask 目錄
python -m src.lbm_mrt_les.runners.run_one_case

# 指定 Config 與 Mask 目錄
python -m src.lbm_mrt_les.runners.run_one_case \
    --config configs/templates/config_template.yaml \
    --mask_dir src/tools/rect_masks
```

### 參數說明
- `--config`: 指定 YAML 設定檔路徑。
- `--mask_dir`: 指定包含 PNG 遮罩檔案的資料夾。程式會自動讀取該資料夾下所有 `.png` 檔案並逐一執行。

---

## 2. 執行批量案例 (run_multi_case) - 推薦

適用於大規模數據集生成。此模式採用 **Config-Mask 一對一** 對應的方式執行，允許每個案例擁有獨立的物理參數 (如不同 Re)。

### 前置準備
1.  準備 `configs/Experiments` 目錄，內含多個 `.yaml` 設定檔 (例如 `case01.yaml`, `case02.yaml`...)。
2.  準備 `mask/Experiments` 目錄，內含同數量的對應 `.png` 遮罩 (例如 `case01.png`, `case02.png`...)。
3.  **檔名排序必須一致**: 程式會依檔名排序進行配對 (第 1 個 Config 配第 1 個 Mask)。

### 基本指令

```bash
python -m src.lbm_mrt_les.runners.run_multi_case \
    --config_dir configs/experiments \
    --mask_dir src/tools/hybrid_maps
```

### 參數說明
- `--config_dir`: 設定檔資料夾路徑。
- `--mask_dir`: 遮罩檔資料夾路徑。

> **注意**: 若檔案數量不一致，程式會報錯並終止，以確保數據對齊正確。

---

## 3. 即時視覺化 (GUI)

當 `config.yaml` 中的 `outputs.gui.enable` 設為 `true` 時，模擬過程中會彈出視窗。

### 視窗資訊
- **標題**: 顯示當前幀數 (Frame)、模擬步數 (Steps) 與 FPS。
- **畫面**:
  - **顏色**: 代表渦度 (Vorticity) 或速度場 (Velocity Magnitude)。
  - **黑色區域**: 障礙物。
  - **白色框線**: 標示 Sponge Layer 與 ROI 邊界。

### 鍵盤控制 (視窗焦點需在 GUI 上)
- **`Esc`**: 關閉視窗並停止當前案例模擬 (若在批量模式，會接著跑下一個)。
- **`s`**: 截圖 (Screenshot) 並儲存至 `outputs/visualization`。

---

## 4. 影片錄製 (Video)

若 `config.yaml` 中的 `outputs.video.enable` 設為 `true`，程式會自動將模擬過程錄製為 MP4 影片。

- **輸出路徑**: `outputs/dataset/video/`
- **檔名格式**: `Re{Re}_{MaskName}.mp4`
- **參數調整**: 可在 Config 中設定 `fps` 與 `interval_steps`。

> **效能提示**: 錄影會佔用額外 CPU/IO 資源，若需追求最高運算速度 (如大規模訓練數據生成)，建議關閉 Video 與 GUI。